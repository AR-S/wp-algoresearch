function restoreUrl(){"function"==typeof history.pushState&&history.pushState({},"",originalUrl)}function removeModal(){jQuery(".site-main .modal").fadeOut(function(){jQuery(this).remove(),jQuery("body").removeClass("overflown"),restoreUrl()})}function replaceContent(a){var b=jQuery(".site-main"),c=a.find(".site-main").children();c.fadeTo(0,0),b.fadeTo(400,0,function(){b.empty(),$grid.packery("destroy"),b.append(c),c.fadeTo(400,1),b.fadeTo(400,1),adjustExcerptHeight(c),$grid=jQuery("body.notes .site-main"),$grid.packery({itemSelector:".hentry"})})}function adjustExcerptHeight(a){a.each(function(){var a=jQuery(this),b=a.find(".text"),c=b.outerHeight()-40,d=b.width(),e=a.find(".entry-header").outerHeight()+54,f=a.find(".entry-excerpt"),g=f.height(),h=c-e,i=15,j=h%i;h=j?h-j:h,h!==g&&(2*i>h?h=0:addEllipsis(f,h,d,i)),f.height(h)})}function addEllipsis(a,b,c,d){var e=jQuery("<p></p>").css({visibility:"hidden"}),f=a[0].innerHTML.trim();f=f.replace(/<p>/,"").replace(/<\/p>/,"");var g=f.split(/\s+/),h="",i=g.length,j=[""],k=!1,l=0,m=0,n=0;for(a.append(e),n;i>n;n++)h=g[n],e[0].innerHTML+=0===n?h:" "+h,m=e[0].getBoundingClientRect().height,k=!1,m>d&&(j[++l]="",e[0].innerHTML=h,k=!0),j[l]+=k||0===n?h:" "+h;e.remove(),j=j.slice(0,b/d),a[0].innerHTML="<p>"+j.join(" ").replace(/\s(\w+)$/,"&hellip;")+"</p>"}function showModal(a){var b=jQuery(".site-menu-drawer"),c=jQuery(".site-main .modal"),d=a.find(".hentry"),e=location.href.match(ajaxRx)[1];d.addClass("open modal "+e).fadeTo(0,0),d.append('<button class="close-modal top">x</button>'),d.append('<button class="close-modal bottom">x</button>'),c.length?c.fadeOut(function(){jQuery(this).remove(),jQuery(".site-main").append(d),jQuery("body").addClass("overflown"),resBaldrickTriggers(),d.fadeTo(400,1),b.removeClass("toggled")}):(jQuery(".site-main").append(d),jQuery("body").addClass("overflown"),resBaldrickTriggers(),d.append('<div class="site-logo"><a href="/" rel="home">ars</a></div>'),d.fadeTo(400,1),b.removeClass("toggled"))}function showNote(a){if(1==a.data("animating"))return!1;a.data("animating",!0);var b=0,c=0,d=a.find(".entry-content");d.css({position:"absolute",top:"-9999999px",height:"auto"}),c=a.outerHeight(),d.css({position:"static",top:""}),b=d.outerHeight(),a.height(b+c),a.addClass("open"),jQuery(".hentry").each(function(){$grid.packery("unstamp",this)}),$grid.packery("stamp",a[0]),shiftLayout(),a.height(c),a.animate({height:b+c+"px"},400,function(){a.data("animating",!1)})}function hideNote(a){if(1==a.data("animating"))return!1;a.data("animating",!0);var b=0,c=a.find(".entry-content"),d=c.outerHeight();a.removeClass("open"),a.height(""),b=a.outerHeight(),$grid.packery("unstamp",a[0]),shiftLayout(),a.height(b+d),a.animate({height:b+"px"},325,function(){a.data("animating",!1)})}function toggleContent(a){var b=a.find(".entry-content");jQuery("body").hasClass("notes")?a.hasClass("open")?hideNote(a):showNote(a):a.hasClass("open")?(a.removeClass("open"),b.slideUp()):(a.addClass("open"),b.slideDown())}function bindLinks(a){if(a.ctrlKey||a.shiftKey||a.metaKey)return!0;var b=jQuery("body").hasClass("notes"),c=new RegExp(/\.[a-z]+$/),d=this.attributes.getNamedItem("href").nodeValue,e=this.href,f=jQuery(this).parents(".hentry");if(f.hasClass("loading"))return a.preventDefault(),!1;if(f.hasClass("loaded"))return toggleContent(f),a.preventDefault(),!1;if("#"!==d&&rootRx.test(e)&&!c.test(e)){var g=b?insertNoteContent:insertContent;return loadLinkContent(e,f,g),f.addClass("loading"),a.preventDefault(),!1}return!0}function loadLinkContent(a,b,c){var d={url:a,method:"GET",dataType:"html"};jQuery.ajax(d).done(function(a){var d=jQuery("<div>").append(jQuery.parseHTML(a));c(d,b)})}function insertNoteContent(a,b){var c=a.find(".entry-content").children(),d=b.find(".entry-content");d.children().remove(),d.append(c),c.imagesLoaded(function(){b.removeClass("loading"),b.addClass("loaded"),b.addClass("open"),showNote(b)})}function shiftLayout(){$grid.packery("shiftLayout")}function insertContent(a,b){var c=b.find(".entry-content"),d=a.find(".entry-content").children(),e=a.find(".entry-header .carousel");c.slideUp(0),c.children().remove(),c.append(d),d.imagesLoaded(function(){b.removeClass("loading"),b.addClass("loaded"),b.addClass("open"),c.slideDown()}),e.length&&(e.height(0),e.addClass("offscreen"),b.find(".entry-header").append(e),e.owlCarousel({margin:0,nav:!1,dots:!0,loop:!1,items:1}),e.fadeOut(0),e.imagesLoaded(function(){b.find(".post-thumbnail").fadeOut(function(){e.removeClass("offscreen"),e.height(""),e.fadeIn(),jQuery(this).remove()})}))}var rootRx=new RegExp("^"+siteroot),ajaxRx=new RegExp(/(about|contact)\/$/),$grid,originalUrl=location.href;jQuery(document).ready(function(){var a=jQuery(".site-menu-drawer");jQuery(".menu-show").on("click",function(b){return a.addClass("toggled"),b.preventDefault(),!1}),jQuery(".menu-hide").on("click",function(b){return a.removeClass("toggled"),b.preventDefault(),!1}),jQuery(".menu-item a").on("click",function(a){return ajaxRx.test(this.href)?("function"==typeof history.pushState&&history.pushState({},"",this.href),loadLinkContent(this.href,null,showModal),a.preventDefault(),!1):void 0}),jQuery(".the-dot").on("click",function(a){return a.preventDefault(),!1}),jQuery(".dot-pagination a").on("click",function(a){return"function"==typeof history.pushState&&history.pushState({},"",this.href),loadLinkContent(this.href,null,replaceContent),a.preventDefault(),!1}),jQuery(".entry-title a, .notes .hentry .wrapper").on("click",bindLinks),jQuery("body").on("click",".faux-footer",function(){var a=jQuery(this).parents(".hentry"),b=a.find(".entry-content");a.removeClass("open"),b.slideUp()}),jQuery("body.single .carousel").owlCarousel({margin:0,nav:!1,dots:!0,loop:!1,items:1}),jQuery(".search-toggle").on("click",function(){var a=jQuery(this).parent();a.toggleClass("active"),a.hasClass("active")&&a.find("input").focus()}),$grid=jQuery("body.notes .site-main"),$grid.packery({itemSelector:".hentry"}),$grid.length&&adjustExcerptHeight($grid.children())}),jQuery(document).keyup(function(a){27===a.keyCode&&removeModal()}),jQuery(window).on("popstate",function(a){return ajaxRx.test(location.href)?loadLinkContent(location.href,null,showModal):(jQuery("body").hasClass("post-type-archive-note")&&loadLinkContent(this.href,null,replaceContent),void removeModal())}),jQuery("body").on("click",".close-modal",removeModal);